// Generated by CoffeeScript 1.6.3
var fs, remoteCoffee, uuid;

fs = require('fs');

uuid = require('uuid');

remoteCoffee = require('remote-coffee');

module.exports = function(phantomCoffeeUrl, env, callback) {
  return remoteCoffee(phantomCoffeeUrl, function(phantomScript) {
    var fifoName, fromPhantom, phantom, stream;
    fifoName = "tmp/" + (uuid.v4().replace(/-/g, ''));
    phantom = require('child_process').spawn('phantomjs', [fifoName, '--load-images=no'], {
      env: env
    });
    fromPhantom = '';
    phantom.stdout.on('data', function(data) {
      return fromPhantom += data.toString();
    });
    phantom.once('close', function(code) {
      return callback(null, fromPhantom);
    });
    phantom.once('error', function(error) {
      console.log('Error creating PhantomJS process: ', error);
      return callback(error, null);
    });
    stream = fs.createWriteStream(fifoName);
    return stream.once('open', function(fd) {
      stream.write(phantomScript);
      return stream.end();
    });
  });
};
